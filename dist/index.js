// ==UserScript==
// @name          Github Enhancer
// @namespace     http://tampermonkey.net/
// @version       1753716804304
// @description   Enhance your Github experience with additional features.
// @author        Jossafossa
// @match         https://github.com/*
// @icon          https://www.google.com/s2/favicons?sz=64&domain=github.com
// @grant         none
// @grant         GM_setValue
// @grant         GM_getValue
// @grant         GM_registerMenuCommand
// @downloadURL   https://raw.githubusercontent.com/jossafossa/github-inject/refs/heads/master/dist/index.js
// @updateURL     https://raw.githubusercontent.com/jossafossa/github-inject/refs/heads/master/dist/index.js
// ==/UserScript==

(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();const p=(e,t)=>{const n=document.querySelector(e);if(n){const s=t(n);document.querySelectorAll(e).forEach(o=>{o.classList.add("fs-copied"),setTimeout(()=>{o.classList.remove("fs-copied")},500)}),navigator.clipboard.writeText(s).then(()=>{console.log(`Copied: ${s}`)}).catch(o=>{console.error("Failed to copy text:",o)})}else console.warn(`Element with selector "${e}" not found.`)},g=({url:e,selector:t,shortcut:n,shortcutLabel:s,callback:r=o=>o.innerText})=>{window.location.href.includes(e)&&(document.addEventListener("keydown",o=>{n(o)&&(o.preventDefault(),p(t,r))}),document.querySelectorAll(t).forEach(o=>{o.dataset.shortcutLabel=s}))},b=()=>{g({url:"github.com",selector:"#partial-discussion-header clipboard-copy",shortcut:e=>e.metaKey&&e.shiftKey&&e.code==="KeyA",shortcutLabel:"⌘⇧A",callback:e=>e.getAttribute("value")??""})},u="lock-merge",y=()=>{const e=document.createElement("input");e.type="checkbox",e.id="lock-merge",document.body.appendChild(e),localStorage.getItem(u)==="checked"&&(e.checked=!0),e.addEventListener("change",()=>{localStorage.setItem(u,e.checked?"checked":"unchecked")})},m=e=>{var r;let t=document.createElement("span");const n=`<svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy">
    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
</svg>`,s=`<svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check color-fg-success">
    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
</svg>`;t.innerHTML=n,t.style.marginLeft="4px",t.style.cursor="pointer",t.style.textDecoration="underline",t.addEventListener("click",function(o){o.preventDefault(),navigator.clipboard.writeText(e.textContent??"").then(()=>{t.innerHTML=s,setTimeout(()=>{t.innerHTML=n},500),console.log("Copied: "+e.textContent)}).catch(a=>{console.error("Failed to copy: ",a)})}),(r=e.parentNode)==null||r.appendChild(t)},v=()=>{const e=document.querySelectorAll("details-collapsible summary a");e.forEach(n=>m(n)),e.length===0&&console.warn("No summary anchors found for copy links.");const t=document.querySelectorAll(".js-details-container .AvatarStack ~ div:nth-last-child(1) a[href*='/commits/']");t.forEach(n=>m(n)),t.length===0&&console.warn("No commit hashes found for copy links.")},d=async e=>new Promise(t=>{const n=setInterval(()=>{const s=document.querySelector(e);s&&(clearInterval(n),t(s))},100)}),l=(...e)=>{console.log("%c[github-extensions]%c","color: #f0db4f; font-weight: bold; background: #323330; padding: 2px 5px; border-radius: 3px;","color: #fff; font-weight: normal; background: #323330; padding: 2px 5px; border-radius: 3px;",...e)},w=()=>{const e=document.querySelector('.gh-header-meta .commit-ref:not(:has([href*="master"]))');return e?e.textContent:!1},x=()=>{const e=document.querySelector(".partial-pull-merging-analytics-js section + div");if(!e)return{};const t=document.createElement("div");e.prepend(t),t.id="fs-errors";const n=document.createElement("div");return e.prepend(n),n.id="fs-messages",{errors:t,messages:n}},k=e=>{const t=document.createElement("span");return t.classList.add("fs-message"),t.innerHTML=e,t},L=()=>{const e=w();if(e)return k(`<a href='https://github.com/simplicate-software/frontend/actions?query=branch:${e}'>Actions of this PR</a>`)},S=()=>{const{messages:e}=x();if(!e)return;const t=L();t&&e.append(t)},M=()=>{S()},A=()=>document.querySelector(".gh-header-meta [title='Status: Merged']")?"merged":document.querySelector("[reviewable_state='draft']")?"draft":document.querySelector("[data-name*='QA-Test'], [data-name*='qa-test']")?"test":!1,I=()=>{let e=!1;const t=setInterval(()=>{const n=A();if(e!==n&&n){const s=`[${n.toUpperCase()}]`;e=!!n;const r=document.querySelector("h1 > bdi");r&&(r.innerHTML=`${s} ${r.innerHTML}`),document.title=`${s} ${document.title}`,clearInterval(t)}},1e3)},T=':root{--f-merge: #8957e5;--f-merge-border: #8957e5;--f-error: #da3633;--f-error-border: rgb(109 27 26);--f-warning: rgb(236, 164, 6);--f-warning-border: rgb(210 153 34);--f-positive: #238636;--f-positive-border: #1f4429;--f-info: #4493f8;--f-info-border: #1f3356}.review-thread-component{--comment-outline-color: var(--f-error-border);outline:2px solid var(--comment-outline-color);opacity:var(--comment-opacity);border:none!important}.review-thread-component>summary{background-color:var(--comment-outline-color)!important}.js-comment-container:hover{opacity:1}.review-thread-component:has(.js-comments-holder>div:nth-last-child(1) img[src*="175005199"]){--comment-outline: 2px solid var(--f-warning-border);transition:.15s ease}.review-thread-component:has(.js-comments-holder>div:nth-last-child(1) img[src*="175005199"]):has(.js-comments-holder>div:nth-last-child(1) .commit-link,[href*="/compare/"]){--comment-outline-color: var(--f-positive-border);--comment-opacity: .5}.review-thread-component[data-resolved=true]{--comment-outline-color: var(--f-positive-border)}body{--body-color: transparent;border-left:1rem solid var(--body-color)!important}body:has(.discussion-sidebar-item [data-name*=qa-test]),body:has(.discussion-sidebar-item [data-name*=QA-Test]){--body-color: var(--f-warning)}body:has(.author[href*=vandergeest]){--body-color: var(--f-positive)}body:has([reviewable_state=draft]){--body-color: var(--f-error)}body:has(.merge-status-item .color-fg-danger){--body-color: var(--f-error)}body:has(.State--merged){--body-color: var(--f-merge)}relative-time:after{font-size:70%;content:" " attr(datetime);font-weight:700;opacity:.5}.Layout-sidebar{resize:horizontal}.js-issue-row:has([aria-label*=Draft],[href*=dependabot]):not(:hover){opacity:.4}#discussion_bucket:has(.TimelineItem:nth-child(1):has([alt*=joosthobma])) .merge-message .BtnGroup:not(:hover){opacity:.2;cursor:not-allowed}[reviewable_state=draft]{outline:1rem solid var(--f-merge)}#lock-merge{position:fixed;bottom:0;right:0;z-index:999}#fs-messages:before,#fs-errors:before,.fs-error,.fs-message{--background: var(--f-info-border);--border: var(--f-info);content:var(--message);padding:8px;background-color:var(--background);color:#fff;border-radius:4px;margin-bottom:1rem;display:flex;border-left:8px solid var(--border)}.fs-message a,.fs-error a{color:inherit;text-decoration:underline}#fs-errors:before,.fs-error{content:var(--error);--background: var(--f-error-border);--border: var(--f-error)}body:has(#lock-merge:checked){--error: "Merging is blocked!"}body:has([title*="fixup!"]){--error: "Please rebase fixups before merging!"}@container style(--error){body #fs-errors+div{cursor:not-allowed}body #fs-errors+div [class*=prc-Button-ButtonBase]{opacity:.2;pointer-events:none}}body:not(body:has(.js-discussion>.TimelineItem:nth-child(1) [alt*=joosthobma])){--error: "This is not your PR to merge!"}[data-shortcut-label]{--background: rgba(255, 255, 255, .1)}[data-shortcut-label]:after{content:attr(data-shortcut-label);font-size:.8rem;background-color:var(--background);outline:4px solid var(--background);color:#fffc;margin-left:.5rem;font-weight:700;text-decoration:none;border-radius:1px}.fs-copied{--background: var(--f-info-border);animation:.3s pulse ease forwards}@keyframes pulse{0%{transform:scale(1)}30%{transform:scale(1.5)}to{transform:scale(1)}}.action-time{display:flex;justify-content:flex-end;list-style:none;padding-block:1rem;align-items:center;gap:4px}';function E(e){const t=e.split(" ");if(t.length!==2)return-1;const n=t[0],s=t[1];if(!n.endsWith("m")||!s.endsWith("s"))return-1;const r=parseInt(n.slice(0,-1)),o=parseInt(s.slice(0,-1));return isNaN(r)||isNaN(o)||r<0||o<0?-1:r*60+o}function q(e){const r=Math.floor(e/86400);let o=e%86400;const a=Math.floor(o/3600);o%=3600;const i=Math.floor(o/60),h=o%60;let c="";return r>0&&(c+=`${r}d `),(a>0||r>0)&&(c+=`${a}h `),c+=`${i}m ${h}s`,c.trim()}const C=()=>{var r,o;const e=document.querySelector("#partial-actions-workflow-runs");if(!e)return;const t=[...e.querySelectorAll(".Box-row > * > .d-table-cell:last-child .issue-keyword")].map(a=>a.innerText),n=t.map(E).reduce((a,i)=>a+i,0),s=q(n);(o=(r=document.querySelector(".paginate-container"))==null?void 0:r.previousElementSibling)==null||o.insertAdjacentHTML("afterend",`<summary class="action-time color-fg-muted pr-2 pr-md-0" aria-haspopup="menu" role="button">
        <svg aria-label="Run duration" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-stopwatch">
    <path d="M5.75.75A.75.75 0 0 1 6.5 0h3a.75.75 0 0 1 0 1.5h-.75v1l-.001.041a6.724 6.724 0 0 1 3.464 1.435l.007-.006.75-.75a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734l-.75.75-.006.007a6.75 6.75 0 1 1-10.548 0L2.72 5.03l-.75-.75a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l.75.75.007.006A6.72 6.72 0 0 1 7.25 2.541V1.5H6.5a.75.75 0 0 1-.75-.75ZM8 14.5a5.25 5.25 0 1 0-.001-10.501A5.25 5.25 0 0 0 8 14.5Zm.389-6.7 1.33-1.33a.75.75 0 1 1 1.061 1.06L9.45 8.861A1.503 1.503 0 0 1 8 10.75a1.499 1.499 0 1 1 .389-2.95Z"></path>
</svg>
        <span class="issue-keyword">
          ${s}
        </span>
      </summary>`),console.log({labels:t,seconds:n,secondsLabel:s})},f=document.createElement("style");f.innerHTML=T;document.head.appendChild(f);const H=async()=>{l("github loaded"),y(),I(),v(),b()};d(".timeline-comment-group").then(H);const $=async()=>{l("pipeline loaded"),M()};d("[class*='MergeBoxSectionHeader-module__wrapper']").then(()=>{$()});const j=()=>{l("action loaded"),C()};d("#partial-actions-workflow-runs").then(j);
